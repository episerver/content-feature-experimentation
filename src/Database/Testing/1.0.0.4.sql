--beginvalidatingquery

		 select 1, 'Upgrading database'

--endvalidatingquery

-- Create MultivariateTest Tables to Store MultivariateTest Information.
DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Testing.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '1'

IF @CurrentMigration < '201703231704110_Add_ConversionReuslt_And_Change_Conversion_Type'
BEGIN
    CREATE TABLE [dbo].[tblABKeyConversionResult] (
    [Id] [uniqueidentifier] NOT NULL,
    [KpiId] [uniqueidentifier] NOT NULL,
    [Conversions] [int] NOT NULL,
    [Weight] [float] NOT NULL,
    [VariantId] [uniqueidentifier] NOT NULL,
    [CreatedDate] [datetime] NOT NULL,
    [ModifiedDate] [datetime] NOT NULL,
    CONSTRAINT [PK_dbo.tblABKeyConversionResult] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_VariantId] ON [dbo].[tblABKeyConversionResult]([VariantId])
ALTER TABLE [dbo].[tblABVariant] ALTER COLUMN [Conversions] [float] NOT NULL
ALTER TABLE [dbo].[tblABKeyConversionResult] ADD CONSTRAINT [FK_dbo.tblABKeyConversionResult_dbo.tblABVariant_VariantId] FOREIGN KEY ([VariantId]) REFERENCES [dbo].[tblABVariant] ([Id]) ON DELETE CASCADE
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201703231704110_Add_ConversionReuslt_And_Change_Conversion_Type', N'Testing.Migrations.Configuration',  0x1F8B0800000000000400ED5D4B6FE43612BE2FB0FF41D06977E1B8ED994BD6E84EE0F12330321E1BD39EC9622F035A62B789E8D11125C7C6627FD91EF293F217B6D47AF12152A424B7BBE1460E698BE44756B1AA587C54CD9FFFFB63FAE35318388F38A1248E66EEF1E191EBE0C88B7D122D676E962EBEFBDEFDF187BFFE657AE1874FCED7AADEFBBC1EB48CE8CC7D48D3D5C96442BD071C227A18122F8969BC480FBD389C203F9EBC3B3AFAE7E4F8788201C2052CC7997ECEA2948478FD07FC7916471E5EA5190AAE631F07B4FC0E25F335AAF3098598AE908767EEC52D99E304467C788D925F710A033DBCC374FDFF7314B8CE6940100C6B8E8385EBA0288A5394C2A04FBE503C4F93385ACE57F0010577CF2B0CF51628A0B824E6A4A96E4AD7D1BB9CAE49D3B082F2329AC6A125E0F1FB925113B1792F76BB3523819517C0F2F439A77ACDCE990BDC3AFD90B3CE75C4DE4ECE8224AFD9C9EEC302753D6D8735E081535639A84506242BFFEFC039CB82344BF02CC2599AA0E0C0B9CDEE03E2FD8C9FEFE25F71348BB22060C70D238732EE037CBA4DE2154ED2E7CF78515273E5BBCE846F37111BD6CD983605993F65047E7F82BED17D806BA998689BDF9134C01502C81610EC3AD7E8E9238E96E9C3CC859FAE73499EB05F7D2961BF4404540C1AA54986ADBB3DC7D44BC8AA908AC19DEBFBBAF93DC2C9E649BC49C8924428B84A71387092E620D1CD248151C8C53417CFB2C01E2E49CF19C8FCF71DD8326BA48BC81F05E71606443CB25A2BEE2D4E3C1CA56859E35E45E9FB77D6A01F114D41A9C98260FFC3B346008E8F8E4610B38BA715F652EC7F2594A4717216C3FA2010A00738F5F2D543D3DC927E589116C48795107FC48F38A827290663653F45FF9E7B718207825CD139594630231E6AA8FB10C70146913D7D0906791B47002B39E907F6093D926521BB3C2C186F90E6459CC0BAE4E1ABC807C26172A9EB7CC6C1BA017D20AB46A715F5BF31CBDC6512879FE3A058FB3AEB7FBB43C912E7AC8E2D1ACDE30C54D09CCCAF282130A14AB2CA7225195279DBB0E54A6DC39C4E1A1FA1CB73503062445742D1C35BF12D80C881100A068AA83B6F2818CDD89465A8B4C7CA32547AD957E54A251E51C54AC4BD4A19AFC1C3FDD11CA2E4F23017E58AFE4222C63BEFED0AC451B9FFA7033D94AF04FF4E8712B5962FFA80FD37E0E2745A2EFBC5BFC532A93D048B71826E3682F21953300B3A4F4CACFB8DB55FA2B1D55456F860BA16B60E58817809DBCDC82328E8A64DA8AA254D5D574199A6413FC2BEA220C3DD4431D5B404B5D75310A3A83C82EF290AC0B87EA788FE4616C89F57642042CB5AD26F1DF80593E5433A743D2AE46D284D3BB18ED40AFBF226B9DDF93531E203145EB08BE3EABB00BE5777538F1A78DF9C8D618F84F99FB709FC2AEF93BE779DB98772407B1BB0462FA6B0E4FAE60FA20BA906F57F5952F96E5E8DDABDC17C013FAFDD5C1A388603AC25E3788D6B2919E0BD9534D6AA201B7AF8BFD7CC11372BED1AD9B1B331D3C62CE47591B968BCA297015A362F0EC651CBBC4BCA5D690ED64B58447C9C04CF00C1BAF0FC045EE3F01E27958A45C84BC92310B566E2CC3D92269CAB7FCAD73ED6D73E8FA3A6AE7C13C82327DE0340FB75FDF7F2CC1573C47E3CA534065B9CCF42E70D077316C38FE322F29D3E47C8DCC5B4F25AE51A668EAC60AE60E667EE3F242E58F65EEFD7B9DEAB3326BEB3635734CC37D1390E708A9D7C2273E7E70C510FF9B29A03B77DFE0BD8729CE0287F80034E0F052924512A1B7E12E537DA410F92042CC365241F6BDDAB58728E571854224A7BCCAFC970AA8369794875CF025BBBB8389D3022DD29E9F229A346B634478E9C2CD546D94A7235B799BB22A94A12362399CAF9D90549EC38A6D09B3CA3330BD1DACA0789B696D6E8F4DA4435B6427ACD08DA989135985393B130EEF32B8AB66643A9173193DDA528D8D28199AD5C9B5C5DEC925877D3B331A9EE9ECFDD116AC55E4C2F5B5D1B335198B9F30C5B41EEBAB2DA2521D6D3B23101D6CFDFF6096FB163863629B46836962845F788E2FC3B7E6A3B29FB0285C5AE9C9647AAA2A8E5B8739C56DBCFB5C7455DA7391F907D56495C790CF5BBC73650E586B1A397E6D9611B6AAD051D28CA87018AA1CADE965107F2E5BC025F5AF48CE0F92B7205346782045846EA44ECAE87674C539B076BA2CAF43C7CA8F9A1133B493F7B9E35309DD57A22DA4A9E93665C6E7924D3CAD58E6DAEF9469721A451233D97D4FBDA97E24AD78DAF4AF08CF75F3D77600CBD4AEBD12971267B2E8359EACD59DDD5908AB1A6DE7F3FFF5F62AB6C333BB96AE0F1BF245355A7FA2A869A789EF6BEA7C4487E75E8646287B7398C81D5C543EDC9D465D349112A597E984E143195D36BB45A9168C9C458965F9C79116079F6DDDC3ED8302C30261E6D8939AC475BF7040B045A62A134BF06F7F12549685A7966AE73E6875235D16F53ACF1556FBC6B26CF5FB5DC57F5F3DF655852C7458C722569B87A098486B9FB9CD38C79E152B575F2B85714A0A4E526F32C0EB23052BBF2EAD665B4220B507E32C7E0420F5924AEC01CAF0C2F6491CA4F161842AC2007269499A39697762C58F9C90AA38A151470AACFE65875B4208B547F34C751460BB2B8CA4AE6FD8801842CBC5866C185D638418E25AD35CC7B680B2464F1DBCACDD1A5B042165A2A34C7AD020C59B8EA9B398A1061C8991ABEC88262F6C901472D5B608EC73F3B6001F91219713A114CB274EC202D05D2410EBFB218AD3BCA7DD5C80B91EA20A0D7CA640CF6424B55790DC5AD558AAB29358A26FE8D05D654DB8BB9B198D7CEECC862ADF0EACDC458D9789BC5B6CD8FB1F75FB8303311AA2EB0591BAA68337E59A8BE5AAD814D8C80B0FE3505E67865D4198B547EB2A18E093BE309640AF6E6C0D81CA88E76C65FF4A423E5BE0B5E37D0CB588DF28129B724159F5E4FA7AAF01B16AAFA66A199CD1D0FA79DEAAB1F0D857B8D6A3DD51B5FA1C43B94BEFAD489B3BDEA54067B70EB78F1C91243885E910085725B856FE252649D6FCAFAA2B60E5B51656F145ED1287027D4E31B04F6E6B3AF31D0626CAF2128433778410DE47C567A8CBDC05B0ABC74CD2156A97BAFAF3B846B8D6979C5D09D4F52BA7328AAE4B17DF123F1F3FB86F933854DD3615EE170FE5B7016109C1F825515AE514416A035450885FBEEE8F89D9085727B32424E28F583962B9AD6B490FC846D20402B8BC86F19CECF40D35CF892611919A34794780F28F95B889EFE3E46964525A07526C561436BCF8E3898795CA644924BF8D0DC883EFC4E47C88DD81BA72337621F22DB332356132AE746B493125D224461B42670EAB4887D485724455C0431B207E37322F6C3684D89784F7A50260746F696B9B6C04843B03112F0EDA0D1E6F272C970D2AB4C20163FCDDCFFACDB9F3857FFFA56401C383709ACC727CE91F3DFF1B3E5E9E834D1C51D94B1F6C7DC7B9932B64FE32ED02DA9E3FA987131715C2F832927FAE967C2B99C71FDA89132C6BD9D15407F66BD139ACAE557188CD622977D848A4F3FD553B2C5940DBDAC508D32C810EDA6746B4F90DFA070733988FCCDA55B1AB65B6D4FA134FAF0B529948651B0D7E4A19AAC3CFE7D835ACCA503DA2F2D2F2C90E3A776A9628C369E90C224EC6AB47C327D635495EFE13798856527525D58255DD90E99AB23727A667AD90999523F38DC3E19EA9F2EC56E2A5FD48CC931C12324691998BCE7F5129C6C61F0FCB8E94CB648F2A468F1E149547646EEBA5F796DABD8D9271CD92291E3B2080C4B73B233A2A67F3FF4DA62D69E1A448E4415E7554A24517963BAD41FC5DB12D8D4DCC730FDE5DDD1BD6966109D3F6F951B44398CBED944586DD2E61351F63C2CE38845C2111DEDE3A42731CF4EA21BCBE0542666994C7443D8A19427BCF20901D6B21931DB4A9BC5C4498BC016E53019C21641A1C598AA51C8DE7892123BA28C762BDD812463B16A93594706334A611435010263B16913794406B3A7C5502B9E4B9BB3C5223B88FC3C165C28E61F6507578E92650391FF13ED11F638E7A9AE73152DE2CA8D13465455110F7A718A7CF0AC4E93942C909742B187295DFF331765E2EE8BF01EFB57D14D96AEB21448C6E17DC0E50AC87D415DFFEB1428FC98A737EBF79C740C126098243F9BBE893E642468128E5FB69C4D2B207227F3270CDF8BB9049F35C5CBE71AE9D33AEFB90950C9BEDA37BEC3E12A00307A13CD119368DD626C5F28FE8897C87BAE5E39AB41BA278267FBF49CA06582425A6234EDE14F90613F7CFAE1FFEBCB4FDB9B800000 , N'6.1.3-40302')


END


GO
